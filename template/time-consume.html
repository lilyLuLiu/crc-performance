<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>Time Consumption Report</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, Helvetica, Arial, sans-serif;
            background-color: #f7f9fc;
            color: #333;
            margin: 0;
            padding: 32px;
        }

        h1 {
            margin-bottom: 8px;
        }

        h2 {
            margin-top: 48px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 6px;
        }

        h3,
        h4 {
            margin-top: 24px;
            color: #444;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
        }

        /* 下载区 */
        .download-list {
            background: #ffffff;
            border-radius: 8px;
            padding: 16px 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            max-width: 600px;
        }

        .download-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .download-list li {
            margin: 8px 0;
        }

        .download-list a {
            color: #1a73e8;
            text-decoration: none;
            font-weight: 500;
        }

        .download-list a:hover {
            text-decoration: underline;
        }

        /* 表格 */
        table {
            width: 100%;
            max-width: 900px;
            border-collapse: collapse;
            margin-top: 12px;
            background: #ffffff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        th,
        td {
            padding: 10px 14px;
            text-align: center;
        }

        th {
            background-color: #f1f3f4;
            font-weight: 600;
        }

        tr:nth-child(even) td {
            background-color: #fafafa;
        }

        /* 行内最大 / 最小值 */
        td.row-max {
            background-color: #ffe5e5 !important;
            /* 浅红背景 */
            color: #b71c1c;
            /* 深红文字 */
            font-weight: 600;
        }

        td.row-min {
            background-color: #e6f4ea !important;
            /* 浅绿背景 */
            color: #1b5e20;
            /* 深绿色文字 */
            font-weight: 600;
        }

        /* 图片居中 */
        img {
            display: block;
            margin: 24px auto;
            max-width: 90%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>

<body>
    <div class="container">

        <h1>Time Consumption</h1>

        <h3>Original Data</h3>
        <div class="download-list">
            <ul>
                <li><a href="time_consume_darwin-amd64.csv" download>darwin-amd64-data</a></li>
                <li><a href="time_consume_darwin-arm64.csv" download>darwin-arm64-data</a></li>
                <li><a href="time_consume_linux-amd64.csv" download>linux-amd64-data</a></li>
                <li><a href="time_consume_linux-arm64.csv" download>linux-arm64-data</a></li>
                <li><a href="time_consume_windows-amd64.csv" download>windows-amd64-data</a></li>
            </ul>
        </div>

        <h2>CRC Start</h2>

        <h4>Average time of CRC start by Platform</h4>
        <table>
            <tr>
                <th>Platform</th>
                <th>Average time of CRC start</th>
            </tr>
            {% for row in timeData['platform']['start'] %}
            <tr>
                <td>{{ row.category }}</td>
                <td>{{ row['time-start'] }}</td>
            </tr>
            {% endfor %}
        </table>

        <h4>Average time of CRC start by platform and bundle</h4>
        <table>
            <tr>
                <th>CRC start by bundle</th>
                {% for row in timeData['bundle']['start']['darwin-amd64'] %}
                <th>{{ row.bundle }}</th>
                {% endfor %}
            </tr>
            {% for name, info in timeData['bundle']['start'].items() %}
            <tr>
                <td>{{ name }}</td>
                {% for row in info %}
                <td>{{ row['time-start'] }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>

        <img src="time-start.png" alt="Time Start Plot">

        <h2>CRC Stop</h2>

        <h4>Average time of CRC stop by Platform</h4>
        <table>
            <tr>
                <th>Platform</th>
                <th>Average time of CRC stop</th>
            </tr>
            {% for row in timeData['platform']['stop'] %}
            <tr>
                <td>{{ row.category }}</td>
                <td>{{ row['time-stop'] }}</td>
            </tr>
            {% endfor %}
        </table>

        <h4>Average time of CRC stop by platform and bundle</h4>
        <table>
            <tr>
                <th>CRC stop by bundle</th>
                {% for row in timeData['bundle']['stop']['darwin-amd64'] %}
                <th>{{ row.bundle }}</th>
                {% endfor %}
            </tr>
            {% for name, info in timeData['bundle']['stop'].items() %}
            <tr>
                <td>{{ name }}</td>
                {% for row in info %}
                <td>{{ row['time-stop'] }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>

        <img src="time-stop.png" alt="Time Stop Plot">

    </div>

    <script>
        function parseTimeToSeconds(str) {
            // 将 1m02s 或 45s 转换为秒数
            let total = 0;
            const match = str.match(/(?:(\d+)m)?(?:(\d+)s)?/);
            if (!match) return 0;
            const minutes = parseInt(match[1] || 0, 10);
            const seconds = parseInt(match[2] || 0, 10);
            total = minutes * 60 + seconds;
            return total;
        }

        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll("table").forEach(table => {
                const rows = Array.from(table.querySelectorAll("tr")).slice(1);

                rows.forEach(row => {
                    const cells = Array.from(row.querySelectorAll("td")).slice(1);

                    if (cells.length <= 1) return; // 只处理 bundle 横向对比表

                    const values = cells
                        .map(td => parseTimeToSeconds(td.textContent))
                        .filter(v => !isNaN(v));

                    if (values.length === 0) return;

                    const max = Math.max(...values);
                    const min = Math.min(...values);

                    cells.forEach(td => {
                        const v = parseTimeToSeconds(td.textContent);
                        if (v === max) td.classList.add("row-max");
                        if (v === min) td.classList.add("row-min");
                    });
                });
            });
        });
    </script>

</body>

</html>